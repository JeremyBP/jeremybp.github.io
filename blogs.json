{"status":"ok","feed":{"url":"https://medium.com/feed/@jeremybp","title":"Stories by JeremyBP on Medium","link":"https://medium.com/@jeremybp?source=rss-278157eec3f4------2","author":"","description":"Stories by JeremyBP on Medium","image":"https://cdn-images-1.medium.com/fit/c/150/150/1*XrGw4sRAf7z_iB9N39MGUg.png"},"items":[{"title":"StarCellar E04: Applying resilience strategies with Apizr","pubDate":"2025-04-16 09:41:10","link":"https://medium.com/@jeremybp/starcellar-e04-applying-resilience-strategies-with-apizr-b52bf81dcac8?source=rss-278157eec3f4------2","guid":"https://medium.com/p/b52bf81dcac8","author":"JeremyBP","thumbnail":"","description":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/800/0*Y1-RS6aea8VQDqTc.gif\"></figure><p>Episode 04 of an Apizr walkthrough building a MAUI app requesting a backend\u00a0API.</p>\n<p>Apizr is a Refit based web api client manager, but resilient (retry, connectivity, cache, auth, log, priority, etc\u2026).</p>\n<p>This episode is about resilience strategies (aka policies).</p>\n<h4>APIZR</h4>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*OfELU_CTxOdcuw-Z\"></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*ZQ05n3Xoxujre4MP\"></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*1pqN9U3QpZTHZKh7\"></figure><h4>The starcellar series</h4>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href\">https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href</a><h3>The starcellar episode\u00a004</h3>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/d24317e1857cac8cd8cfd77878b52253/href\">https://medium.com/media/d24317e1857cac8cd8cfd77878b52253/href</a><h3>Applaying resilience strategies Without\u00a0Apizr</h3>\n<p>First, the <strong>Without.Apizr</strong> project as\u00a0usual!</p>\n<p>Start by referencing NuGet\u00a0package:</p>\n<ul><li><strong>Microsoft.Extensions.Http.Resilience</strong></li></ul>\n<p>Now open the MauiProgram class and scroll to the Refit registration part.</p>\n<p>There, add the following extension methods to both RefitClient registrations:</p>\n<pre>.AddStandardResilienceHandler()</pre>\n<p>Here we provide the built-in resilience handler provided by Microsoft to the Refit\u2019s HttpClient request pipeline.</p>\n<p>This handler will obviously handle any managed failures with its default configuration.</p>\n<p>You can run the app and see that there\u2019s now some retries into the VS output in case of network\u00a0failure.</p>\n<h3>Configuring resilience strategies With\u00a0Apizr</h3>\n<p>Now the <strong>With.Apizr</strong> project!</p>\n<p>Start by referencing the same NuGet\u00a0package:</p>\n<ul><li><strong>Microsoft.Extensions.Http.Resilience</strong></li></ul>\n<p>Now open the MauiProgram class and scroll to the Apizr registration part.</p>\n<p>There, add the following extension methods to both Apizr registrations, right into the <em>ConfigureHttpClientBuilder </em>method:</p>\n<pre>.ConfigureHttpClientBuilder(clientBuilder =&gt; clientBuilder<br>    .AddStandardResilienceHandler()));</pre>\n<p>Here we provide the built-in resilience handler provided by Microsoft to the Apizr\u2019s HttpClient request pipeline.</p>\n<p>This handler will obviously handle any managed failures with its default configuration.</p>\n<p>You can run the app and see that there\u2019s now some retries into the VS output in case of network\u00a0failure.</p>\n<h3>Adjusting standard resilience handler\u2019s configuration</h3>\n<p>In both <strong>With.Apizr</strong> or <strong>Without.Apizr</strong> projects, you definitly can adjust the standard resilience handler\u2019s configuration.</p>\n<p>Here is how to do that by adjusting app settings:</p>\n<pre>\"ResilienceOptions\": {<br>    \"Retry\": {<br>        \"BackoffType\": \"Exponential\",<br>        \"UseJitter\": true,<br>        \"MaxRetryAttempts\": 3<br>    }<br>}</pre>\n<p>Then providing the settings:</p>\n<pre>.ConfigureHttpClientBuilder(builder =&gt; builder<br>    .AddStandardResilienceHandler(configuration.GetSection(\"ResilienceOptions\")))</pre>\n<p>Or even manually:</p>\n<pre>.ConfigureHttpClientBuilder(clientBuilder =&gt; clientBuilder<br>    .AddStandardResilienceHandler(resilienceOptions =&gt;<br>    {<br>        resilienceOptions.CircuitBreaker.MinimumThroughput = 10;<br>        // and so on...<br>    }))</pre>\n<h3>Applying strategies by attribute design</h3>\n<p>You may want to apply specific resilience strategies to specific requests\u00a0only.</p>\n<p>Apizr let you do that by attribute design.</p>\n<p>First, you have to define your strategies by building a pipeline:</p>\n<pre>var resiliencePipelineBuilder = new ResiliencePipelineBuilder&lt;HttpResponseMessage&gt;()<br>    .AddRetry(<br>        new RetryStrategyOptions&lt;HttpResponseMessage&gt;<br>        {<br>            ShouldHandle = new PredicateBuilder&lt;HttpResponseMessage&gt;()<br>                .Handle&lt;HttpRequestException&gt;()<br>                .HandleResult(response =&gt;<br>                    response.StatusCode is &gt;= HttpStatusCode.InternalServerError<br>                        or HttpStatusCode.RequestTimeout),<br>            Delay = TimeSpan.FromSeconds(1),<br>            MaxRetryAttempts = 3,<br>            UseJitter = true,<br>            BackoffType = DelayBackoffType.Exponential<br>        });</pre>\n<p>Then just register it into your container:</p>\n<pre>// (Polly) Add the resilience pipeline with its key to your container<br>services.AddResiliencePipeline&lt;string, HttpResponseMessage&gt;(\"TransientHttpError\",<br>    builder =&gt; builder.AddPipeline(resiliencePipelineBuilder.Build()));</pre>\n<p>And finally activate it by attribute:</p>\n<pre>[BaseAddress(\"/wines\"), Log, ResiliencePipeline(\"TransientHttpError\")]<br>public interface ICellarApi<br>{<br>    [Get(\"/\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"/\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>Here we\u2019re telling Apizr to apply such a pipeline to any ICellarApi request.</p>\n<h4>Get more of\u00a0it</h4>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=b52bf81dcac8\" width=\"1\" height=\"1\" alt=\"\">\n","content":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/800/0*Y1-RS6aea8VQDqTc.gif\"></figure><p>Episode 04 of an Apizr walkthrough building a MAUI app requesting a backend\u00a0API.</p>\n<p>Apizr is a Refit based web api client manager, but resilient (retry, connectivity, cache, auth, log, priority, etc\u2026).</p>\n<p>This episode is about resilience strategies (aka policies).</p>\n<h4>APIZR</h4>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*OfELU_CTxOdcuw-Z\"></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*ZQ05n3Xoxujre4MP\"></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*1pqN9U3QpZTHZKh7\"></figure><h4>The starcellar series</h4>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href\">https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href</a><h3>The starcellar episode\u00a004</h3>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/d24317e1857cac8cd8cfd77878b52253/href\">https://medium.com/media/d24317e1857cac8cd8cfd77878b52253/href</a><h3>Applaying resilience strategies Without\u00a0Apizr</h3>\n<p>First, the <strong>Without.Apizr</strong> project as\u00a0usual!</p>\n<p>Start by referencing NuGet\u00a0package:</p>\n<ul><li><strong>Microsoft.Extensions.Http.Resilience</strong></li></ul>\n<p>Now open the MauiProgram class and scroll to the Refit registration part.</p>\n<p>There, add the following extension methods to both RefitClient registrations:</p>\n<pre>.AddStandardResilienceHandler()</pre>\n<p>Here we provide the built-in resilience handler provided by Microsoft to the Refit\u2019s HttpClient request pipeline.</p>\n<p>This handler will obviously handle any managed failures with its default configuration.</p>\n<p>You can run the app and see that there\u2019s now some retries into the VS output in case of network\u00a0failure.</p>\n<h3>Configuring resilience strategies With\u00a0Apizr</h3>\n<p>Now the <strong>With.Apizr</strong> project!</p>\n<p>Start by referencing the same NuGet\u00a0package:</p>\n<ul><li><strong>Microsoft.Extensions.Http.Resilience</strong></li></ul>\n<p>Now open the MauiProgram class and scroll to the Apizr registration part.</p>\n<p>There, add the following extension methods to both Apizr registrations, right into the <em>ConfigureHttpClientBuilder </em>method:</p>\n<pre>.ConfigureHttpClientBuilder(clientBuilder =&gt; clientBuilder<br>    .AddStandardResilienceHandler()));</pre>\n<p>Here we provide the built-in resilience handler provided by Microsoft to the Apizr\u2019s HttpClient request pipeline.</p>\n<p>This handler will obviously handle any managed failures with its default configuration.</p>\n<p>You can run the app and see that there\u2019s now some retries into the VS output in case of network\u00a0failure.</p>\n<h3>Adjusting standard resilience handler\u2019s configuration</h3>\n<p>In both <strong>With.Apizr</strong> or <strong>Without.Apizr</strong> projects, you definitly can adjust the standard resilience handler\u2019s configuration.</p>\n<p>Here is how to do that by adjusting app settings:</p>\n<pre>\"ResilienceOptions\": {<br>    \"Retry\": {<br>        \"BackoffType\": \"Exponential\",<br>        \"UseJitter\": true,<br>        \"MaxRetryAttempts\": 3<br>    }<br>}</pre>\n<p>Then providing the settings:</p>\n<pre>.ConfigureHttpClientBuilder(builder =&gt; builder<br>    .AddStandardResilienceHandler(configuration.GetSection(\"ResilienceOptions\")))</pre>\n<p>Or even manually:</p>\n<pre>.ConfigureHttpClientBuilder(clientBuilder =&gt; clientBuilder<br>    .AddStandardResilienceHandler(resilienceOptions =&gt;<br>    {<br>        resilienceOptions.CircuitBreaker.MinimumThroughput = 10;<br>        // and so on...<br>    }))</pre>\n<h3>Applying strategies by attribute design</h3>\n<p>You may want to apply specific resilience strategies to specific requests\u00a0only.</p>\n<p>Apizr let you do that by attribute design.</p>\n<p>First, you have to define your strategies by building a pipeline:</p>\n<pre>var resiliencePipelineBuilder = new ResiliencePipelineBuilder&lt;HttpResponseMessage&gt;()<br>    .AddRetry(<br>        new RetryStrategyOptions&lt;HttpResponseMessage&gt;<br>        {<br>            ShouldHandle = new PredicateBuilder&lt;HttpResponseMessage&gt;()<br>                .Handle&lt;HttpRequestException&gt;()<br>                .HandleResult(response =&gt;<br>                    response.StatusCode is &gt;= HttpStatusCode.InternalServerError<br>                        or HttpStatusCode.RequestTimeout),<br>            Delay = TimeSpan.FromSeconds(1),<br>            MaxRetryAttempts = 3,<br>            UseJitter = true,<br>            BackoffType = DelayBackoffType.Exponential<br>        });</pre>\n<p>Then just register it into your container:</p>\n<pre>// (Polly) Add the resilience pipeline with its key to your container<br>services.AddResiliencePipeline&lt;string, HttpResponseMessage&gt;(\"TransientHttpError\",<br>    builder =&gt; builder.AddPipeline(resiliencePipelineBuilder.Build()));</pre>\n<p>And finally activate it by attribute:</p>\n<pre>[BaseAddress(\"/wines\"), Log, ResiliencePipeline(\"TransientHttpError\")]<br>public interface ICellarApi<br>{<br>    [Get(\"/\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"/\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>Here we\u2019re telling Apizr to apply such a pipeline to any ICellarApi request.</p>\n<h4>Get more of\u00a0it</h4>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=b52bf81dcac8\" width=\"1\" height=\"1\" alt=\"\">\n","enclosure":{},"categories":["refit","dotnet","apizr","rest-api"]},{"title":"StarCellar E03: Configuring logging with Apizr","pubDate":"2024-12-13 10:39:16","link":"https://medium.com/@jeremybp/starcellar-e03-configuring-logging-with-apizr-2ed60c6cc054?source=rss-278157eec3f4------2","guid":"https://medium.com/p/2ed60c6cc054","author":"JeremyBP","thumbnail":"","description":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/600/0*XETbs6JKCdRpKSJw.gif\"></figure><p>Episode 03 of an Apizr walkthrough building a MAUI app requesting a backend\u00a0API.</p>\n<p>Apizr is a Refit based web api client manager, but resilient (retry, connectivity, cache, auth, log, priority, etc\u2026).</p>\n<p>This episode is about configuring logging.</p>\n<h4>APIZR</h4>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*4LxZQ4UdEVMKwXcI\"></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*70Kri-8Q4iwvMLQc\"></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*-N5cCABAsgoIN3Ox\"></figure><h4>The starcellar series</h4>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href\">https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href</a><h4>The starcellar episode\u00a003</h4>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/279bf1441f84663395f725248d1ad790/href\">https://medium.com/media/279bf1441f84663395f725248d1ad790/href</a><h4>Configuring logging Without\u00a0Apizr</h4>\n<p>First, the <strong>Without.Apizr</strong> project as\u00a0usual!</p>\n<p>Start by referencing NuGet packages:</p>\n<ul><li><strong>HttpTracer</strong></li></ul>\n<p>Now open the MauiProgram class and scroll to the Refit registration part.</p>\n<p>There, add the following RefitSettings parameter to both RefitClient registrations:</p>\n<pre>new RefitSettings<br>{<br>    HttpMessageHandlerFactory = () =&gt; new HttpTracerHandler<br>    {<br>        Verbosity = HttpMessageParts.All<br>    }<br>}</pre>\n<p>Here we provide the HttpTracerHandler to Refit by setting its HttpMessageHandler.</p>\n<p>HttpTracerHandler will trace http traces with a verbosity set to\u00a0<em>All</em>.</p>\n<p>You can run the app and see that there\u2019s now some http traces right into the VS\u00a0output.</p>\n<p>You should see something like\u00a0that:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/486/0*epX_X4e4hQJLbaDd.gif\"></figure><h4>Configuring logging With\u00a0Apizr</h4>\n<p>Now the <strong>With.Apizr</strong> project!</p>\n<p>Nothing more to install, just decorate APIs by the Log attribute provided by Apizr\u00a0like:</p>\n<pre>[BaseAddress(\"/wines\"), Log]<br>public interface ICellarApi<br>{<br>    [Get(\"\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>Here we tell Apizr to log all traces by default thanks to attribute design.</p>\n<p>You can run the app and see that there\u2019s now some http traces right into the VS\u00a0output.</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/486/0*jBajaHczOdmo71Mx.gif\"></figure><h4>Adjusting logging options With\u00a0Apizr</h4>\n<p>When you don\u2019t say anything but just Log like in previous API design, Apizr will use following default logging\u00a0options:</p>\n<ul>\n<li>HttpTracerMode: Everything (will log everything anytime)</li>\n<li>TrafficVerbosity: All (will log all http\u00a0traces)</li>\n<li>LogLevels: [Low] Trace, [Medium] Information and [High] Critical (log levels to use while writing\u00a0logs)</li>\n</ul>\n<p>You definitly can ajust logging options instead of using default\u00a0ones.</p>\n<p>Here is the same API with more custom\u00a0options:</p>\n<pre>[assembly:Log]<br>namespace StarCellar.With.Apizr.Services.Apis.Cellar<br>{<br>    [BaseAddress(\"/wines\"), <br>    Log(HttpMessageParts.RequestAll, HttpTracerMode.ErrorsAndExceptionsOnly, LogLevel.Information)]<br>    public interface ICellarApi<br>    {<br>        [Get(\"\"), <br>        Log(HttpMessageParts.RequestBody, HttpTracerMode.ExceptionsOnly, LogLevel.Warning)]<br>        Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>        [Get(\"/{id}\")]<br>        Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>        [Post(\"\")]<br>        Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>        [Put(\"/{id}\")]<br>        Task UpdateWineAsync(Guid id, Wine item);<br><br>        [Delete(\"/{id}\")]<br>        Task DeleteWineAsync(Guid id);<br>    }<br>}</pre>\n<p>There, you can see that we decided to apply the default logging configuration to all assembly APIs, but a custom one to ICellarApi specific API and all its requests, but a custom one to GetWinesAsync specific\u00a0request.</p>\n<p>You can run the app and see that everything\u2019s logging as asked\u00a0to.</p>\n<h4>Understanding Apizr logging configuration pipeline</h4>\n<p>Previously, we configured logging options by design, decorating attribute at different levels:</p>\n<ul>\n<li>APIs Assembly: will be shared by all APIs in the\u00a0assembly</li>\n<li>API interface: will be set to decorated API only, overriding parent logging\u00a0options</li>\n<li>Request method: will be set to decorated request only, overriding parent logging\u00a0options</li>\n</ul>\n<p>But we can do the same fluently at registration and request time (with ApizrRequestOptions parameter) like:</p>\n<pre>// Registering<br>builder.Services.AddApizr(<br>    registry =&gt; registry<br>        .AddManagerFor&lt;ICellarApi&gt;(options =&gt; options<br>            .WithLogging(HttpMessageParts.RequestAll, HttpTracerMode.ErrorsAndExceptionsOnly, LogLevel.Information))<br>        .AddManagerFor&lt;IFileApi&gt;(),<br><br>    options =&gt; options<br>        .WithLogging());<br><br>...<br><br>// Requesting<br>var wines = await _cellarApiManager.ExecuteAsync((api, opt) =&gt; api.GetWinesAsync(opt), <br>    options =&gt; options.WithLogging(HttpMessageParts.RequestBody, HttpTracerMode.ExceptionsOnly, LogLevel.Warning));</pre>\n<p>Actually, we even can mix it all together, I mean Design, Register and Request time configurations.</p>\n<p>Just keep in mind that fluent configuration always wins over attribute one, and the closest configuration to the request always wins over all\u00a0others.</p>\n<h4>Redacting logged headers With\u00a0Apizr</h4>\n<p>While logging http traces, you may have to respect some privacy or security policies, like hiding sensitive headers.</p>\n<p>Apizr lets you do that by design using a star *\u00a0symbol:</p>\n<pre>[BaseAddress(\"/wines\"), Log]<br>public interface ICellarApi<br>{<br>    [Get(\"\"), Headers(\"MyHeaderKey: *MyHeaderValue*\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    ...<br>}</pre>\n<p>Or fluently thanks to the following options:</p>\n<pre>// direct header configuration<br>options =&gt; options.WithHeaders([\"MyHeaderKey: *MyHeaderValue*\"])<br><br>// OR direct redacting configuration<br>options =&gt; options.WithLoggedHeadersRedactionNames(new[]{ \"MyHeaderKey\" })<br><br>// OR factory redacting configuration<br>options =&gt; options.WithLoggedHeadersRedactionRule(header =&gt; header == \"MyHeaderKey\")</pre>\n<p>From there, you should see your logs with headers redacted like\u00a0so:</p>\n<pre> ==================== HTTP REQUEST: [GET] ==================== <br>GET https://mycustomurl.com/path<br>Request Headers:<br>MyHeaderKey: *</pre>\n<h4>Running the\u00a0app</h4>\n<p>Nothing\u2019s changed on the user experience point of view. The same app, but with some options adjusted and shared thanks to\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/411/0*YyHeqKa72FCDQeQZ.gif\"></figure><h4>Get more of\u00a0it</h4>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=2ed60c6cc054\" width=\"1\" height=\"1\" alt=\"\">\n","content":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/600/0*XETbs6JKCdRpKSJw.gif\"></figure><p>Episode 03 of an Apizr walkthrough building a MAUI app requesting a backend\u00a0API.</p>\n<p>Apizr is a Refit based web api client manager, but resilient (retry, connectivity, cache, auth, log, priority, etc\u2026).</p>\n<p>This episode is about configuring logging.</p>\n<h4>APIZR</h4>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*4LxZQ4UdEVMKwXcI\"></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*70Kri-8Q4iwvMLQc\"></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*-N5cCABAsgoIN3Ox\"></figure><h4>The starcellar series</h4>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href\">https://medium.com/media/e3ca72dbefbb5c2030d0f2d84ae5ce22/href</a><h4>The starcellar episode\u00a003</h4>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/279bf1441f84663395f725248d1ad790/href\">https://medium.com/media/279bf1441f84663395f725248d1ad790/href</a><h4>Configuring logging Without\u00a0Apizr</h4>\n<p>First, the <strong>Without.Apizr</strong> project as\u00a0usual!</p>\n<p>Start by referencing NuGet packages:</p>\n<ul><li><strong>HttpTracer</strong></li></ul>\n<p>Now open the MauiProgram class and scroll to the Refit registration part.</p>\n<p>There, add the following RefitSettings parameter to both RefitClient registrations:</p>\n<pre>new RefitSettings<br>{<br>    HttpMessageHandlerFactory = () =&gt; new HttpTracerHandler<br>    {<br>        Verbosity = HttpMessageParts.All<br>    }<br>}</pre>\n<p>Here we provide the HttpTracerHandler to Refit by setting its HttpMessageHandler.</p>\n<p>HttpTracerHandler will trace http traces with a verbosity set to\u00a0<em>All</em>.</p>\n<p>You can run the app and see that there\u2019s now some http traces right into the VS\u00a0output.</p>\n<p>You should see something like\u00a0that:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/486/0*epX_X4e4hQJLbaDd.gif\"></figure><h4>Configuring logging With\u00a0Apizr</h4>\n<p>Now the <strong>With.Apizr</strong> project!</p>\n<p>Nothing more to install, just decorate APIs by the Log attribute provided by Apizr\u00a0like:</p>\n<pre>[BaseAddress(\"/wines\"), Log]<br>public interface ICellarApi<br>{<br>    [Get(\"\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>Here we tell Apizr to log all traces by default thanks to attribute design.</p>\n<p>You can run the app and see that there\u2019s now some http traces right into the VS\u00a0output.</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/486/0*jBajaHczOdmo71Mx.gif\"></figure><h4>Adjusting logging options With\u00a0Apizr</h4>\n<p>When you don\u2019t say anything but just Log like in previous API design, Apizr will use following default logging\u00a0options:</p>\n<ul>\n<li>HttpTracerMode: Everything (will log everything anytime)</li>\n<li>TrafficVerbosity: All (will log all http\u00a0traces)</li>\n<li>LogLevels: [Low] Trace, [Medium] Information and [High] Critical (log levels to use while writing\u00a0logs)</li>\n</ul>\n<p>You definitly can ajust logging options instead of using default\u00a0ones.</p>\n<p>Here is the same API with more custom\u00a0options:</p>\n<pre>[assembly:Log]<br>namespace StarCellar.With.Apizr.Services.Apis.Cellar<br>{<br>    [BaseAddress(\"/wines\"), <br>    Log(HttpMessageParts.RequestAll, HttpTracerMode.ErrorsAndExceptionsOnly, LogLevel.Information)]<br>    public interface ICellarApi<br>    {<br>        [Get(\"\"), <br>        Log(HttpMessageParts.RequestBody, HttpTracerMode.ExceptionsOnly, LogLevel.Warning)]<br>        Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>        [Get(\"/{id}\")]<br>        Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>        [Post(\"\")]<br>        Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>        [Put(\"/{id}\")]<br>        Task UpdateWineAsync(Guid id, Wine item);<br><br>        [Delete(\"/{id}\")]<br>        Task DeleteWineAsync(Guid id);<br>    }<br>}</pre>\n<p>There, you can see that we decided to apply the default logging configuration to all assembly APIs, but a custom one to ICellarApi specific API and all its requests, but a custom one to GetWinesAsync specific\u00a0request.</p>\n<p>You can run the app and see that everything\u2019s logging as asked\u00a0to.</p>\n<h4>Understanding Apizr logging configuration pipeline</h4>\n<p>Previously, we configured logging options by design, decorating attribute at different levels:</p>\n<ul>\n<li>APIs Assembly: will be shared by all APIs in the\u00a0assembly</li>\n<li>API interface: will be set to decorated API only, overriding parent logging\u00a0options</li>\n<li>Request method: will be set to decorated request only, overriding parent logging\u00a0options</li>\n</ul>\n<p>But we can do the same fluently at registration and request time (with ApizrRequestOptions parameter) like:</p>\n<pre>// Registering<br>builder.Services.AddApizr(<br>    registry =&gt; registry<br>        .AddManagerFor&lt;ICellarApi&gt;(options =&gt; options<br>            .WithLogging(HttpMessageParts.RequestAll, HttpTracerMode.ErrorsAndExceptionsOnly, LogLevel.Information))<br>        .AddManagerFor&lt;IFileApi&gt;(),<br><br>    options =&gt; options<br>        .WithLogging());<br><br>...<br><br>// Requesting<br>var wines = await _cellarApiManager.ExecuteAsync((api, opt) =&gt; api.GetWinesAsync(opt), <br>    options =&gt; options.WithLogging(HttpMessageParts.RequestBody, HttpTracerMode.ExceptionsOnly, LogLevel.Warning));</pre>\n<p>Actually, we even can mix it all together, I mean Design, Register and Request time configurations.</p>\n<p>Just keep in mind that fluent configuration always wins over attribute one, and the closest configuration to the request always wins over all\u00a0others.</p>\n<h4>Redacting logged headers With\u00a0Apizr</h4>\n<p>While logging http traces, you may have to respect some privacy or security policies, like hiding sensitive headers.</p>\n<p>Apizr lets you do that by design using a star *\u00a0symbol:</p>\n<pre>[BaseAddress(\"/wines\"), Log]<br>public interface ICellarApi<br>{<br>    [Get(\"\"), Headers(\"MyHeaderKey: *MyHeaderValue*\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    ...<br>}</pre>\n<p>Or fluently thanks to the following options:</p>\n<pre>// direct header configuration<br>options =&gt; options.WithHeaders([\"MyHeaderKey: *MyHeaderValue*\"])<br><br>// OR direct redacting configuration<br>options =&gt; options.WithLoggedHeadersRedactionNames(new[]{ \"MyHeaderKey\" })<br><br>// OR factory redacting configuration<br>options =&gt; options.WithLoggedHeadersRedactionRule(header =&gt; header == \"MyHeaderKey\")</pre>\n<p>From there, you should see your logs with headers redacted like\u00a0so:</p>\n<pre> ==================== HTTP REQUEST: [GET] ==================== <br>GET https://mycustomurl.com/path<br>Request Headers:<br>MyHeaderKey: *</pre>\n<h4>Running the\u00a0app</h4>\n<p>Nothing\u2019s changed on the user experience point of view. The same app, but with some options adjusted and shared thanks to\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/411/0*YyHeqKa72FCDQeQZ.gif\"></figure><h4>Get more of\u00a0it</h4>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=2ed60c6cc054\" width=\"1\" height=\"1\" alt=\"\">\n","enclosure":{},"categories":["rest-api","apizr","refit","dotnet"]},{"title":"StarCellar E02: Adjusting basics with Apizr","pubDate":"2024-12-06 09:40:42","link":"https://medium.com/@jeremybp/starcellar-e02-adjusting-basics-with-apizr-02069fc8c3c5?source=rss-278157eec3f4------2","guid":"https://medium.com/p/02069fc8c3c5","author":"JeremyBP","thumbnail":"","description":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/600/0*Wcov7CtFG9qtjfOA.gif\"></figure><p>Episode 02 of an Apizr walkthrough building a MAUI app requesting a backend\u00a0API.</p>\n<p>Apizr is a Refit based web api client manager, but resilient (retry, connectivity, cache, auth, log, priority, etc\u2026).</p>\n<p>This episode is about adjusting some basic\u00a0options.</p>\n<h3>Apizr</h3>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><a href=\"https://apizr.net/\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*9ppc8kuIeu5hLrFV\"></a></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><a href=\"https://github.com/Respawnsive/Apizr\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*fOswmWd5yM_5k8wd\"></a></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><a href=\"https://www.youtube.com/playlist?list=PLP7ES6CZYy_3zYjmOJzi3K_GZlViorgUO\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*lg2Wn2DgN15jDppN\"></a></figure><h3>The starcellar series</h3>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href\">https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href</a><h3>The starcellar episode\u00a002</h3>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/27ff9aa3ab65b76a2280db0121234995/href\">https://medium.com/media/27ff9aa3ab65b76a2280db0121234995/href</a><h4>Adjusting basic options Without\u00a0Apizr</h4>\n<p>First, the <strong>Without.Apizr</strong> project!</p>\n<p>I\u2019ll try to set the base address, not from any constant value but loaded from an appsettings.json file.</p>\n<p>Start by referencing some NuGet packages:</p>\n<ul>\n<li><strong>Microsoft.Extensions.Configuration.Binder</strong></li>\n<li><strong>Microsoft.Extensions.Configuration.Json</strong></li>\n<li><strong>Microsoft.Extensions.FileProviders.Embedded</strong></li>\n</ul>\n<p>Now add a json file and set it to EmbeddedResource (needed by MAUI but not for any other project\u00a0type).</p>\n<p>Then write something like this into\u00a0it:</p>\n<pre>{<br>  \"AppSettings\": {<br>    \"BaseAddress\": \"https://YOUR_BASE_ADDRESS\"<br>  }<br>}</pre>\n<p>Now create an <strong>AppSettings</strong> class file looking\u00a0like:</p>\n<pre>public class AppSettings<br>{<br>    public string BaseAddress { get; set; }<br>}</pre>\n<p>Then open the MauiProgram class and scroll to the Refit registration part.</p>\n<p>There, replace\u00a0all:</p>\n<pre>.ConfigureHttpClient(c =&gt; c.BaseAddress = new Uri(Constants.BaseAddress));</pre>\n<p>by:</p>\n<pre>.ConfigureHttpClient((sp, c) =&gt; c.BaseAddress = new Uri(sp.GetRequiredService&lt;IConfiguration&gt;()<br>    .GetRequiredSection(\"AppSettings\").Get&lt;AppSettings&gt;().BaseAddress));</pre>\n<p>Here we set the base address from our appsettings instead of former constant.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Adjusting basic options With\u00a0Apizr</h4>\n<p>Now the <strong>With.Apizr</strong> project!</p>\n<p>Repeat the exact same steps you did previously without Apizr but the MauiProgram\u2019s registration part.</p>\n<p>Insert into both ICellarApi and IFileApi registrations the following builder parameter:</p>\n<pre>options =&gt; options.ConfigureHttpClientBuilder(<br>    httpClientBuilder =&gt; httpClientBuilder.ConfigureHttpClient(<br>        (sp, c) =&gt; c.BaseAddress = new Uri(sp.GetRequiredService&lt;IConfiguration&gt;()<br>            .GetRequiredSection(\"AppSettings\")<br>            .Get&lt;AppSettings&gt;()<br>            .BaseAddress)))</pre>\n<p>Here we set the base address fluently from our appsettings, instead of former constant previously set by attribute design.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Sharing common options With Apizr\u00a0registry</h4>\n<p>I don\u2019t like to repeat myself while coding,\u00a0really!</p>\n<p>So when it came to Apizr, I managed to let it offer a way to share some common options between multiple\u00a0apis.</p>\n<p>That\u2019s where the registry comes\u00a0in.</p>\n<p>Instead of repeating registrations despite the same options, replace it all\u00a0by:</p>\n<pre>builder.Services.AddApizr(<br>    registry =&gt; registry<br>        .AddManagerFor&lt;ICellarApi&gt;()<br>        .AddManagerFor&lt;IFileApi&gt;(),<br><br>    options =&gt; options<br>        .WithBaseAddress(sp =&gt; sp.GetRequiredService&lt;IConfiguration&gt;()<br>        .GetRequiredSection(\"AppSettings\")<br>        .Get&lt;AppSettings&gt;()<br>        .BaseAddress));</pre>\n<p>There, you can see that we added our cellar and file apis to the Apizr registry, then we provided a base address to be set to both of\u00a0it.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Sharing more options With\u00a0Apizr</h4>\n<p>Previously, we shared options between different apis.</p>\n<p>But we can share options between different requests of a single api\u00a0too.</p>\n<p>If you look at the ICellarApi interface, you\u2019ll find some kind of duplicated code, the \u201c/wines\u201d\u00a0path:</p>\n<pre>public interface ICellarApi<br>{<br>    [Get(\"/wines\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/wines/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"/wines\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/wines/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/wines/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>There, we could adjust attributes like\u00a0so:</p>\n<pre>[BaseAddress(\"/wines\")]<br>public interface ICellarApi<br>{<br>    [Get(\"\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>Here the common \u201c/wines\u201d path is shared at interface level to be set to all its requests.</p>\n<p>Apizr will merge the base address with that common path, then with the request\u00a0one.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<p>Note that it could be done by fluent configuration instead of attribute.</p>\n<p>In such scenario, we would just remove the base address attribute from our latest design and adjust the registration like:</p>\n<pre>builder.Services.AddApizr(<br>    registry =&gt; registry<br>        .AddManagerFor&lt;ICellarApi&gt;(options =&gt; options.WithBasePath(\"/wines\"))<br>        .AddManagerFor&lt;IFileApi&gt;(),<br><br>    options =&gt; options<br>        .WithBaseAddress(sp =&gt; sp.GetRequiredService&lt;IConfiguration&gt;()<br>        .GetRequiredSection(\"AppSettings\")<br>        .Get&lt;AppSettings&gt;()<br>        .BaseAddress));</pre>\n<p>Two ways to do the same thing, depending on your\u00a0needs.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Running the\u00a0app</h4>\n<p>Nothing\u2019s changed on the user experience point of view. The same app, but with some options adjusted and shared thanks to\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/411/0*yI9ptdm-i0NXUvlx.gif\"></figure><h3>Get more of\u00a0it</h3>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=02069fc8c3c5\" width=\"1\" height=\"1\" alt=\"\">\n","content":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/600/0*Wcov7CtFG9qtjfOA.gif\"></figure><p>Episode 02 of an Apizr walkthrough building a MAUI app requesting a backend\u00a0API.</p>\n<p>Apizr is a Refit based web api client manager, but resilient (retry, connectivity, cache, auth, log, priority, etc\u2026).</p>\n<p>This episode is about adjusting some basic\u00a0options.</p>\n<h3>Apizr</h3>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><a href=\"https://apizr.net/\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*9ppc8kuIeu5hLrFV\"></a></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><a href=\"https://github.com/Respawnsive/Apizr\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*fOswmWd5yM_5k8wd\"></a></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><a href=\"https://www.youtube.com/playlist?list=PLP7ES6CZYy_3zYjmOJzi3K_GZlViorgUO\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*lg2Wn2DgN15jDppN\"></a></figure><h3>The starcellar series</h3>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href\">https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href</a><h3>The starcellar episode\u00a002</h3>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/27ff9aa3ab65b76a2280db0121234995/href\">https://medium.com/media/27ff9aa3ab65b76a2280db0121234995/href</a><h4>Adjusting basic options Without\u00a0Apizr</h4>\n<p>First, the <strong>Without.Apizr</strong> project!</p>\n<p>I\u2019ll try to set the base address, not from any constant value but loaded from an appsettings.json file.</p>\n<p>Start by referencing some NuGet packages:</p>\n<ul>\n<li><strong>Microsoft.Extensions.Configuration.Binder</strong></li>\n<li><strong>Microsoft.Extensions.Configuration.Json</strong></li>\n<li><strong>Microsoft.Extensions.FileProviders.Embedded</strong></li>\n</ul>\n<p>Now add a json file and set it to EmbeddedResource (needed by MAUI but not for any other project\u00a0type).</p>\n<p>Then write something like this into\u00a0it:</p>\n<pre>{<br>  \"AppSettings\": {<br>    \"BaseAddress\": \"https://YOUR_BASE_ADDRESS\"<br>  }<br>}</pre>\n<p>Now create an <strong>AppSettings</strong> class file looking\u00a0like:</p>\n<pre>public class AppSettings<br>{<br>    public string BaseAddress { get; set; }<br>}</pre>\n<p>Then open the MauiProgram class and scroll to the Refit registration part.</p>\n<p>There, replace\u00a0all:</p>\n<pre>.ConfigureHttpClient(c =&gt; c.BaseAddress = new Uri(Constants.BaseAddress));</pre>\n<p>by:</p>\n<pre>.ConfigureHttpClient((sp, c) =&gt; c.BaseAddress = new Uri(sp.GetRequiredService&lt;IConfiguration&gt;()<br>    .GetRequiredSection(\"AppSettings\").Get&lt;AppSettings&gt;().BaseAddress));</pre>\n<p>Here we set the base address from our appsettings instead of former constant.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Adjusting basic options With\u00a0Apizr</h4>\n<p>Now the <strong>With.Apizr</strong> project!</p>\n<p>Repeat the exact same steps you did previously without Apizr but the MauiProgram\u2019s registration part.</p>\n<p>Insert into both ICellarApi and IFileApi registrations the following builder parameter:</p>\n<pre>options =&gt; options.ConfigureHttpClientBuilder(<br>    httpClientBuilder =&gt; httpClientBuilder.ConfigureHttpClient(<br>        (sp, c) =&gt; c.BaseAddress = new Uri(sp.GetRequiredService&lt;IConfiguration&gt;()<br>            .GetRequiredSection(\"AppSettings\")<br>            .Get&lt;AppSettings&gt;()<br>            .BaseAddress)))</pre>\n<p>Here we set the base address fluently from our appsettings, instead of former constant previously set by attribute design.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Sharing common options With Apizr\u00a0registry</h4>\n<p>I don\u2019t like to repeat myself while coding,\u00a0really!</p>\n<p>So when it came to Apizr, I managed to let it offer a way to share some common options between multiple\u00a0apis.</p>\n<p>That\u2019s where the registry comes\u00a0in.</p>\n<p>Instead of repeating registrations despite the same options, replace it all\u00a0by:</p>\n<pre>builder.Services.AddApizr(<br>    registry =&gt; registry<br>        .AddManagerFor&lt;ICellarApi&gt;()<br>        .AddManagerFor&lt;IFileApi&gt;(),<br><br>    options =&gt; options<br>        .WithBaseAddress(sp =&gt; sp.GetRequiredService&lt;IConfiguration&gt;()<br>        .GetRequiredSection(\"AppSettings\")<br>        .Get&lt;AppSettings&gt;()<br>        .BaseAddress));</pre>\n<p>There, you can see that we added our cellar and file apis to the Apizr registry, then we provided a base address to be set to both of\u00a0it.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Sharing more options With\u00a0Apizr</h4>\n<p>Previously, we shared options between different apis.</p>\n<p>But we can share options between different requests of a single api\u00a0too.</p>\n<p>If you look at the ICellarApi interface, you\u2019ll find some kind of duplicated code, the \u201c/wines\u201d\u00a0path:</p>\n<pre>public interface ICellarApi<br>{<br>    [Get(\"/wines\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/wines/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"/wines\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/wines/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/wines/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>There, we could adjust attributes like\u00a0so:</p>\n<pre>[BaseAddress(\"/wines\")]<br>public interface ICellarApi<br>{<br>    [Get(\"\")]<br>    Task&lt;IEnumerable&lt;Wine&gt;&gt; GetWinesAsync();<br><br>    [Get(\"/{id}\")]<br>    Task&lt;Wine&gt; GetWineDetailsAsync(Guid id);<br><br>    [Post(\"\")]<br>    Task&lt;Wine&gt; CreateWineAsync(Wine item);<br><br>    [Put(\"/{id}\")]<br>    Task UpdateWineAsync(Guid id, Wine item);<br><br>    [Delete(\"/{id}\")]<br>    Task DeleteWineAsync(Guid id);<br>}</pre>\n<p>Here the common \u201c/wines\u201d path is shared at interface level to be set to all its requests.</p>\n<p>Apizr will merge the base address with that common path, then with the request\u00a0one.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<p>Note that it could be done by fluent configuration instead of attribute.</p>\n<p>In such scenario, we would just remove the base address attribute from our latest design and adjust the registration like:</p>\n<pre>builder.Services.AddApizr(<br>    registry =&gt; registry<br>        .AddManagerFor&lt;ICellarApi&gt;(options =&gt; options.WithBasePath(\"/wines\"))<br>        .AddManagerFor&lt;IFileApi&gt;(),<br><br>    options =&gt; options<br>        .WithBaseAddress(sp =&gt; sp.GetRequiredService&lt;IConfiguration&gt;()<br>        .GetRequiredSection(\"AppSettings\")<br>        .Get&lt;AppSettings&gt;()<br>        .BaseAddress));</pre>\n<p>Two ways to do the same thing, depending on your\u00a0needs.</p>\n<p>You can run the app and see that everything\u2019s still\u00a0ok.</p>\n<h4>Running the\u00a0app</h4>\n<p>Nothing\u2019s changed on the user experience point of view. The same app, but with some options adjusted and shared thanks to\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/411/0*yI9ptdm-i0NXUvlx.gif\"></figure><h3>Get more of\u00a0it</h3>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=02069fc8c3c5\" width=\"1\" height=\"1\" alt=\"\">\n","enclosure":{},"categories":["rest-api","refit","dotnet","apizr"]},{"title":"StarCellar E01: Getting Started with Apizr","pubDate":"2024-12-03 11:01:31","link":"https://medium.com/@jeremybp/starcellar-e01-getting-started-with-apizr-47509b9f3876?source=rss-278157eec3f4------2","guid":"https://medium.com/p/47509b9f3876","author":"JeremyBP","thumbnail":"","description":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/600/0*1AbNK8TpxUMiDAGm.gif\"></figure><p>4 years and counting between Apizr v1 and its latest\u00a0v6.4.</p>\n<p>This resilient Refit manager has been developped and maintained for my own needs, but open sourced and published on NuGet for free from the begining.</p>\n<p>That said, I did not took the time to show how to use each and every features of it, so that\u2019s what I\u2019m trying to do now by creating this\u00a0series.</p>\n<p>I\u2019ll build a MAUI sample app called StarCellar to manage a wine cellar (I\u2019m french after all \ud83d\ude42 ), both with and without Apizr to show what\u2019s different while requesting a minimal\u00a0API.</p>\n<p>So let\u2019s get\u00a0started!</p>\n<h4>Apizr</h4>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><a href=\"https://apizr.net/\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*9ppc8kuIeu5hLrFV\"></a></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><a href=\"https://github.com/Respawnsive/Apizr\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*fOswmWd5yM_5k8wd\"></a></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><a href=\"https://www.youtube.com/playlist?list=PLP7ES6CZYy_3zYjmOJzi3K_GZlViorgUO\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*lg2Wn2DgN15jDppN\"></a></figure><h4>The starcellar series</h4>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href\">https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href</a><h4>The starcellar episode\u00a001</h4>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/a06be133958ee4f9126a7fce216976f9/href\">https://medium.com/media/a06be133958ee4f9126a7fce216976f9/href</a><h4><strong>The application</strong></h4>\n<p>Like I said, there\u2019s a minimal backend API project and 2 MAUI projects:</p>\n<ul>\n<li>\n<strong>StarCellar.Api:</strong> Minimal backend API offering wine bottle CRUDing, file management and authentication</li>\n<li>\n<strong>StarCellar.Without.Apizr:</strong> MAUI app to manage the cellar without using Apizr but Refit with 3rd part\u00a0libs</li>\n<li>\n<strong>StarCellar.With.Apizr:</strong> MAUI app to manage the cellar by using Apizr with integrated libs</li>\n</ul>\n<p>The MAUI app is quite simple with features\u00a0like:</p>\n<ul>\n<li>Show all wines from the cellar in a list\u00a0view</li>\n<li>Show more infos about the selected wine in a details\u00a0view</li>\n<li>Change wine infos in a edit view (image, title, description and\u00a0score)</li>\n<li>Add a new wine to the cellar in the edit\u00a0view</li>\n</ul>\n<p>For this Getting Started episode, both <em>With</em> and <em>Without</em> projects are yet configured and functional with just Refit in place, so I\u2019ll work on the <em>With</em> project\u00a0only.</p>\n<h4>Installing apizr</h4>\n<p>Start by removing the <strong>Refit</strong> package from the <em>With</em> project and install the <strong>Apizr.Extensions.Microsoft.DependencyInjection</strong> one\u00a0instead.</p>\n<p>Setting base address by attribute</p>\n<p>Open the <strong>ICellarApi </strong>interface from <em>Services &gt; Apis &gt; Cellar</em>\u00a0folder.</p>\n<p>Add a <strong>BaseAddress </strong>attribute over the interface with <strong>Constants.BaseAddress</strong> as parameter.</p>\n<p>Repeat the operation with the <strong>IFileApi</strong>.</p>\n<h4>Registering Apizr</h4>\n<p>Into <strong>MauiProgram</strong><em>:</em></p>\n<ul><li>Replace folowing former <strong>Refit</strong> registration block:</li></ul>\n<pre>builder.Services.AddRefitClient&lt;ICellarApi&gt;() <br>    .ConfigureHttpClient(c =&gt; c.BaseAddress = new Uri(Constants.BaseAddress)); <br><br>builder.Services.AddRefitClient&lt;IFileApi&gt;() <br>    .ConfigureHttpClient(c =&gt; c.BaseAddress = new Uri(Constants.BaseAddress));</pre>\n<p>by the <strong>Apizr</strong>\u00a0one:</p>\n<pre>builder.Services.AddApizrManagerFor&lt;ICellarApi&gt;();<br>builder.Services.AddApizrManagerFor&lt;IFileApi&gt;();</pre>\n<p><strong>Using Apizr managers from ViewModels</strong></p>\n<p>Now the managers are registered, let\u2019s use it from our ViewModels.</p>\n<p>Open all ViewModels from <em>ViewModels </em>folder.</p>\n<p>Inject <strong>IApizrManager&lt;ICellarApi&gt; _cellarApiManager</strong> instead of <strong>ICellarApi _cellarApi</strong> into all ViewModel\u2019s constructors.</p>\n<p>Now use the managed\u00a0api!</p>\n<ul><li>Replace call:</li></ul>\n<pre>_cellarApi.GetWinesAsync();</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.GetWinesAsync());</pre>\n<ul><li>Then replace\u00a0call:</li></ul>\n<pre>_cellarApi.DeleteWineAsync(Wine.Id);</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.DeleteWineAsync(Wine.Id));</pre>\n<ul><li>Then replace\u00a0call:</li></ul>\n<pre>_cellarApi.CreateWineAsync(Wine);</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.CreateWineAsync(Wine));</pre>\n<ul><li>Finaly replace\u00a0call:</li></ul>\n<pre>_cellarApi.UpdateWineAsync(Wine.Id, Wine);</pre>\n<p>by the managed\u00a0on:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.UpdateWineAsync(Wine.Id, Wine));</pre>\n<p>We also have to manage the file api, so inject <strong>IApizrManager&lt;IFileApi&gt; _fileApiManager</strong> instead of <strong>IFileApi _fileApi</strong> into WineEditViewModel\u2019s constructor.</p>\n<ul><li>Then replace\u00a0call:</li></ul>\n<pre>_fileApi.UploadAsync(streamPart);</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_fileApiManager.ExecuteAsync(api =&gt; api.UploadAsync(streamPart));</pre>\n<p>And we\u2019re\u00a0good!</p>\n<p>All calls will be managed by Apizr, so here in this example, Apizr will set the base address by\u00a0design.</p>\n<h4>Running the\u00a0app</h4>\n<p>Nothing\u2019s changed on the user experience point of view. The same app, but with requests managed by\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/411/0*eehffyYnO0-qBTdD.gif\"></figure><h4>Get more of\u00a0it</h4>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=47509b9f3876\" width=\"1\" height=\"1\" alt=\"\">\n","content":"\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/600/0*1AbNK8TpxUMiDAGm.gif\"></figure><p>4 years and counting between Apizr v1 and its latest\u00a0v6.4.</p>\n<p>This resilient Refit manager has been developped and maintained for my own needs, but open sourced and published on NuGet for free from the begining.</p>\n<p>That said, I did not took the time to show how to use each and every features of it, so that\u2019s what I\u2019m trying to do now by creating this\u00a0series.</p>\n<p>I\u2019ll build a MAUI sample app called StarCellar to manage a wine cellar (I\u2019m french after all \ud83d\ude42 ), both with and without Apizr to show what\u2019s different while requesting a minimal\u00a0API.</p>\n<p>So let\u2019s get\u00a0started!</p>\n<h4>Apizr</h4>\n<p>If you\u2019re new to Apizr, you shoud know that it\u2019s based on Refit and aims to provide many more features on top of it, like retry handling, connectivity check, cache management, authentication handling, priority management, and so on\u2026 It\u2019s here to help me to don\u2019t repeat myself into each and every projects while dealing with api request calls and resilience needs.</p>\n<p>Get the big picture by reading the documentation:</p>\n<figure><a href=\"https://apizr.net/\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/196/0*9ppc8kuIeu5hLrFV\"></a></figure><p>Feel free to browse code, tests and samples and maybe to submit PRs or\u00a0ideas:</p>\n<figure><a href=\"https://github.com/Respawnsive/Apizr\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/192/0*fOswmWd5yM_5k8wd\"></a></figure><p>Don\u2019t forget the YouTube Channel Playlist about\u00a0Apizr:</p>\n<figure><a href=\"https://www.youtube.com/playlist?list=PLP7ES6CZYy_3zYjmOJzi3K_GZlViorgUO\"><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/106/0*lg2Wn2DgN15jDppN\"></a></figure><h4>The starcellar series</h4>\n<p>The StarCellar walkthrough series is built thanks to multiple episodes, each with a dedicated source code branch, blog post and playlist\u00a0video.</p>\n<p>Feel free to fork the project and start from the main branch, so that you could follow this tutorial coding by yourself. If you do so, don\u2019t forget to run the API through a Dev Tunnel and to update the MAUI app\u2019s base\u00a0address.</p>\n<a href=\"https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href\">https://medium.com/media/e78f4b37dcfc41431aabf279678c44cf/href</a><h4>The starcellar episode\u00a001</h4>\n<p>The current episode is covered by this\u00a0video:</p>\n<a href=\"https://medium.com/media/a06be133958ee4f9126a7fce216976f9/href\">https://medium.com/media/a06be133958ee4f9126a7fce216976f9/href</a><h4><strong>The application</strong></h4>\n<p>Like I said, there\u2019s a minimal backend API project and 2 MAUI projects:</p>\n<ul>\n<li>\n<strong>StarCellar.Api:</strong> Minimal backend API offering wine bottle CRUDing, file management and authentication</li>\n<li>\n<strong>StarCellar.Without.Apizr:</strong> MAUI app to manage the cellar without using Apizr but Refit with 3rd part\u00a0libs</li>\n<li>\n<strong>StarCellar.With.Apizr:</strong> MAUI app to manage the cellar by using Apizr with integrated libs</li>\n</ul>\n<p>The MAUI app is quite simple with features\u00a0like:</p>\n<ul>\n<li>Show all wines from the cellar in a list\u00a0view</li>\n<li>Show more infos about the selected wine in a details\u00a0view</li>\n<li>Change wine infos in a edit view (image, title, description and\u00a0score)</li>\n<li>Add a new wine to the cellar in the edit\u00a0view</li>\n</ul>\n<p>For this Getting Started episode, both <em>With</em> and <em>Without</em> projects are yet configured and functional with just Refit in place, so I\u2019ll work on the <em>With</em> project\u00a0only.</p>\n<h4>Installing apizr</h4>\n<p>Start by removing the <strong>Refit</strong> package from the <em>With</em> project and install the <strong>Apizr.Extensions.Microsoft.DependencyInjection</strong> one\u00a0instead.</p>\n<p>Setting base address by attribute</p>\n<p>Open the <strong>ICellarApi </strong>interface from <em>Services &gt; Apis &gt; Cellar</em>\u00a0folder.</p>\n<p>Add a <strong>BaseAddress </strong>attribute over the interface with <strong>Constants.BaseAddress</strong> as parameter.</p>\n<p>Repeat the operation with the <strong>IFileApi</strong>.</p>\n<h4>Registering Apizr</h4>\n<p>Into <strong>MauiProgram</strong><em>:</em></p>\n<ul><li>Replace folowing former <strong>Refit</strong> registration block:</li></ul>\n<pre>builder.Services.AddRefitClient&lt;ICellarApi&gt;() <br>    .ConfigureHttpClient(c =&gt; c.BaseAddress = new Uri(Constants.BaseAddress)); <br><br>builder.Services.AddRefitClient&lt;IFileApi&gt;() <br>    .ConfigureHttpClient(c =&gt; c.BaseAddress = new Uri(Constants.BaseAddress));</pre>\n<p>by the <strong>Apizr</strong>\u00a0one:</p>\n<pre>builder.Services.AddApizrManagerFor&lt;ICellarApi&gt;();<br>builder.Services.AddApizrManagerFor&lt;IFileApi&gt;();</pre>\n<p><strong>Using Apizr managers from ViewModels</strong></p>\n<p>Now the managers are registered, let\u2019s use it from our ViewModels.</p>\n<p>Open all ViewModels from <em>ViewModels </em>folder.</p>\n<p>Inject <strong>IApizrManager&lt;ICellarApi&gt; _cellarApiManager</strong> instead of <strong>ICellarApi _cellarApi</strong> into all ViewModel\u2019s constructors.</p>\n<p>Now use the managed\u00a0api!</p>\n<ul><li>Replace call:</li></ul>\n<pre>_cellarApi.GetWinesAsync();</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.GetWinesAsync());</pre>\n<ul><li>Then replace\u00a0call:</li></ul>\n<pre>_cellarApi.DeleteWineAsync(Wine.Id);</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.DeleteWineAsync(Wine.Id));</pre>\n<ul><li>Then replace\u00a0call:</li></ul>\n<pre>_cellarApi.CreateWineAsync(Wine);</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.CreateWineAsync(Wine));</pre>\n<ul><li>Finaly replace\u00a0call:</li></ul>\n<pre>_cellarApi.UpdateWineAsync(Wine.Id, Wine);</pre>\n<p>by the managed\u00a0on:</p>\n<pre>_cellarApiManager.ExecuteAsync(api =&gt; api.UpdateWineAsync(Wine.Id, Wine));</pre>\n<p>We also have to manage the file api, so inject <strong>IApizrManager&lt;IFileApi&gt; _fileApiManager</strong> instead of <strong>IFileApi _fileApi</strong> into WineEditViewModel\u2019s constructor.</p>\n<ul><li>Then replace\u00a0call:</li></ul>\n<pre>_fileApi.UploadAsync(streamPart);</pre>\n<p>by the managed\u00a0one:</p>\n<pre>_fileApiManager.ExecuteAsync(api =&gt; api.UploadAsync(streamPart));</pre>\n<p>And we\u2019re\u00a0good!</p>\n<p>All calls will be managed by Apizr, so here in this example, Apizr will set the base address by\u00a0design.</p>\n<h4>Running the\u00a0app</h4>\n<p>Nothing\u2019s changed on the user experience point of view. The same app, but with requests managed by\u00a0Apizr:</p>\n<figure><img alt=\"\" src=\"https://cdn-images-1.medium.com/max/411/0*eehffyYnO0-qBTdD.gif\"></figure><h4>Get more of\u00a0it</h4>\n<p>Feel free to ask me anything on twitter, or opening a discussion, issue or PR on\u00a0GitHub.</p>\n<p>Again, it\u2019s basically all built for my own use and motivated by my needs. But it\u2019s live on Nuget and opened to all so feel free to contribute.</p>\n<p>Apizr brings many more features so you should head to the next episode to continue your walkthrough path.</p>\n<img src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=47509b9f3876\" width=\"1\" height=\"1\" alt=\"\">\n","enclosure":{},"categories":["refit","apizr","dotnet","rest-api"]}]}